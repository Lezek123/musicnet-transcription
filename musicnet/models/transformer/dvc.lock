schema: '2.0'
stages:
  preprocess:
    cmd: python ../../preprocessing/wav_nmel_to_notes/preprocess.py
    deps:
    - path: ../../../data/MusicNet/musicnet/musicnet
      hash: md5
      md5: 00306b63ca8e52bf0bfc89063c3570a8.dir
      size: 21728897172
      nfiles: 660
    params:
      ../../preprocessing/wav_nmel_to_notes/params.yaml:
        datasets:
          train:
            size: 5000
            file_count: 30
          val:
            size: 1000
            file_count: 10
        preprocessor:
          n_mels: 100
          chunk_size_sec: 10
          chunk_shift_sec: 5
          target_sr: 16000
          note_rounding: 0.01
          n_fft: 400
          hop_length: 160
        use_converted_midis: true
    outs:
    - path: ../../../data/preprocessed/wav_nmel_to_notes
      hash: md5
      md5: 5edfea23420b7c608f3fa91364439573.dir
      size: 39486896370
      nfiles: 80
  train:
    cmd: python train.py
    deps:
    - path: ../../../data/preprocessed/wav_nmel_to_notes
      hash: md5
      md5: 750793fa870f566915acffa32886ff80.dir
      size: 36920280370
      nfiles: 80
    params:
      ../../../params.yaml:
        midi_to_wav.programs_whitelist:
        - 0
        transformer:
          architecture: encoder-only
          dataset_size: 1.0
          d_model: 128
          num_layers: 4
          num_heads: 8
          dff: 512
          mha_dropout: 0.0
          input_dropout: 0.0
          batch_size: 8
          epochs: 100
          warmup_steps: 6250
          max_lr: 0.0002
        wav_specs_and_notes.preprocessor.n_filters: 200
        wav_specs_and_notes.use_converted_midis: true
    outs:
    - path: dvclive/metrics.json
      hash: md5
      md5: fe11fcf1b871c49468af2a6c0bb107ea
      size: 214
    - path: dvclive/plots
      hash: md5
      md5: b8d079ddb010123bc88bac57abb940d6.dir
      size: 2726
      nfiles: 4
    - path: model.keras
      hash: md5
      md5: d9305f5c3df6daef5e33610c035bfbce
      size: 33554193
    - path: model.weights.h5
      hash: md5
      md5: 4e69992b25424c245720f63b29748597
      size: 33552344
