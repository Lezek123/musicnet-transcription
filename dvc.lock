schema: '2.0'
stages:
  preprocess:
    cmd: python musicnet/preprocessing/wav_specs_and_notes/preprocess.py
    deps:
    - path: data/MusicNet/musicnet/musicnet
      hash: md5
      md5: 00306b63ca8e52bf0bfc89063c3570a8.dir
      size: 21728897172
      nfiles: 660
    params:
      params.yaml:
        midi_to_wav.programs_whitelist:
        - 0
        wav_specs_and_notes:
          use_converted_midis: true
          preprocessor:
            chunk_size_sec: 10
            chunk_shift_sec: 5
            target_sr: 44100
            note_rounding: 0.01
            spectogram:
              n_fft: 2205
              hop_length: 441
              min_hz: 0
              n_filters: 200
              unit: decibels
          datasets:
            train:
              size: 0.8
              file_count: 30
            val:
              size: 0.2
              file_count: 10
    outs:
    - path: data/preprocessed/wav_specs_and_notes
      hash: md5
      md5: 0db524f9f52aa438feddb31230b74e4f.dir
      size: 46198100210
      nfiles: 80
  train:
    cmd: python musicnet/models/cnn/train.py
    deps:
    - path: data/preprocessed/wav_specs_and_notes
      hash: md5
      md5: 0db524f9f52aa438feddb31230b74e4f.dir
      size: 46198100210
      nfiles: 80
    params:
      params.yaml:
        cnn:
          dataset_size: 1.0
          n_layers: 5
          n_neurons: 2048
          activation: gelu
          kernel_size: 16
          batch_size: 8
          epochs: 80
          lr: 0.001
          dropout_rate: 0.0
          conv_type: separable
        midi_to_wav.programs_whitelist:
        - 0
        wav_specs_and_notes.preprocessor.spectogram.n_filters: 200
        wav_specs_and_notes.use_converted_midis: true
    outs:
    - path: dvclive/metrics.json
      hash: md5
      md5: 37f9d7395a2033c996ecd564b4e3f861
      size: 457
    - path: dvclive/plots
      hash: md5
      md5: 0d3d61f6270e901265f3d442e5adac41.dir
      size: 17742
      nfiles: 10
    - path: musicnet/models/cnn/model.keras
      hash: md5
      md5: ea0f9547438488e6f82c7e521076fe2e
      size: 210501471
