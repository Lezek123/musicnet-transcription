schema: '2.0'
stages:
  preprocess:
    cmd: python musicnet/preprocess.py
    deps:
    - path: data/MusicNet/musicnet/musicnet
      hash: md5
      md5: 00306b63ca8e52bf0bfc89063c3570a8.dir
      size: 21728897172
      nfiles: 660
    params:
      params.yaml:
        preprocess:
          chunk_size_sec: 10
          chunk_shift_sec: 5
          target_sr: 16000
          note_rounding: 0.01
          n_fft: 400
          hop_length: 160
          datasets:
            train:
              size: 0.8
              file_count: 30
            val:
              size: 0.2
              file_count: 10
        shared:
          n_mels: 100
    outs:
    - path: data/train
      hash: md5
      md5: 8952d3fe03f96f304adcd87c5950e7f5.dir
      size: 25314131970
      nfiles: 30
    - path: data/val
      hash: md5
      md5: 55a53f10afe70d12d933d38e13e908bb.dir
      size: 6325252260
      nfiles: 10
  train:
    cmd: python musicnet/models/cnn/train.py
    deps:
    - path: data/preprocessed/wav_specs_and_notes
      hash: md5
      md5: 1194046808f122bdd334856d656df3b7.dir
      size: 46198100210
      nfiles: 80
    params:
      params.yaml:
        cnn:
          dataset_size: 1.0
          n_layers: 2
          n_neurons: 2048
          kernel_size: 32
          batch_size: 8
          epochs: 200
          lr: auto
          conv_type: separable
        midi_to_wav.programs_whitelist:
        - 0
        wav_specs_and_notes.preprocessor.n_filters: 200
        wav_specs_and_notes.use_converted_midis: true
    outs:
    - path: dvclive/metrics.json
      hash: md5
      md5: beddacb3dd20fe97e5f5b94f9bd1969e
      size: 213
    - path: dvclive/plots
      hash: md5
      md5: feba5acc5385890ab3b0f6ce5d7ead3a.dir
      size: 17658
      nfiles: 4
    - path: musicnet/models/cnn/model.keras
      hash: md5
      md5: 38256ca830e2d9a74613f72d51e55659
      size: 59032408
