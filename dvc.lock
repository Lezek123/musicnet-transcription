schema: '2.0'
stages:
  preprocess:
    cmd: python musicnet/preprocess.py
    deps:
    - path: data/MusicNet/musicnet/musicnet
      hash: md5
      md5: 00306b63ca8e52bf0bfc89063c3570a8.dir
      size: 21728897172
      nfiles: 660
    params:
      params.yaml:
        preprocess:
          chunk_size_sec: 10
          chunk_shift_sec: 5
          target_sr: 16000
          note_rounding: 0.01
          n_fft: 400
          hop_length: 160
          datasets:
            train:
              size: 0.8
              file_count: 30
            val:
              size: 0.2
              file_count: 10
        shared:
          n_mels: 100
    outs:
    - path: data/train
      hash: md5
      md5: 8952d3fe03f96f304adcd87c5950e7f5.dir
      size: 25314131970
      nfiles: 30
    - path: data/val
      hash: md5
      md5: 55a53f10afe70d12d933d38e13e908bb.dir
      size: 6325252260
      nfiles: 10
  train:
    cmd: python musicnet/models/cnn/train.py
    deps:
    - path: data/preprocessed/wav_specs_and_notes
      hash: md5
      md5: 1194046808f122bdd334856d656df3b7.dir
      size: 46198100210
      nfiles: 80
    params:
      params.yaml:
        cnn:
          dataset_size: 1.0
          n_layers: 5
          n_neurons: 1024
          activation: gelu
          kernel_size: 32
          batch_size: 8
          epochs: 100
          lr: 0.001
          dropout_rate: 0.0
          conv_type: separable
        midi_to_wav.programs_whitelist:
        - 0
        wav_specs_and_notes.preprocessor.spectogram.n_filters: 200
        wav_specs_and_notes.use_converted_midis: true
    outs:
    - path: dvclive/metrics.json
      hash: md5
      md5: 90ce29bc94b8f6c06034593cce93b937
      size: 214
    - path: dvclive/plots
      hash: md5
      md5: 1800fb8dd7ed85a7013c00f655c93d4d.dir
      size: 8885
      nfiles: 4
    - path: musicnet/models/cnn/model.keras
      hash: md5
      md5: cbf23ada1b01852f0f2ee9b61208d661
      size: 55996905
