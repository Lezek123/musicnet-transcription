schema: '2.0'
stages:
  preprocess:
    cmd: python musicnet/preprocess.py
    deps:
    - path: data/MusicNet/musicnet/musicnet
      hash: md5
      md5: 00306b63ca8e52bf0bfc89063c3570a8.dir
      size: 21728897172
      nfiles: 660
    params:
      params.yaml:
        preprocess:
          chunk_size_sec: 10
          chunk_shift_sec: 5
          target_sr: 16000
          note_rounding: 0.01
          n_fft: 400
          hop_length: 160
          datasets:
            train:
              size: 0.8
              file_count: 30
            val:
              size: 0.2
              file_count: 10
        shared:
          n_mels: 100
    outs:
    - path: data/train
      hash: md5
      md5: 8952d3fe03f96f304adcd87c5950e7f5.dir
      size: 25314131970
      nfiles: 30
    - path: data/val
      hash: md5
      md5: 55a53f10afe70d12d933d38e13e908bb.dir
      size: 6325252260
      nfiles: 10
  train:
    cmd: python musicnet/train.py
    deps:
    - path: data/train
      hash: md5
      md5: 8952d3fe03f96f304adcd87c5950e7f5.dir
      size: 25314131970
      nfiles: 30
    - path: data/val
      hash: md5
      md5: 55a53f10afe70d12d933d38e13e908bb.dir
      size: 6325252260
      nfiles: 10
    params:
      params.yaml:
        shared:
          n_mels: 100
        train:
          architecture: encoder-only
          d_model: 128
          num_layers: 4
          num_heads: 8
          dff: 512
          mha_dropout: 0.0
          input_dropout: 0.0
          batch_size: 8
          epochs: 60
          warmup_steps: 4800
          max_lr: 0.0002
    outs:
    - path: dvclive/metrics.json
      hash: md5
      md5: 4fda6c73ca6c58c2df4e8d990f238028
      size: 214
    - path: dvclive/plots
      hash: md5
      md5: 48869fe4acf55775f1ae2286067240ba.dir
      size: 1454
      nfiles: 4
    - path: musicnet/model.keras
      hash: md5
      md5: 5da213edc28ebfbc96fab6f885ce1a8d
      size: 34375012
    - path: musicnet/model.weights.h5
      hash: md5
      md5: e4140981dcf5ac03aed834c213b68d57
      size: 34373204
